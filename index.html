<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã€V10.0ã€‘å°å—åœŸåœ°é–‹ç™¼è²¡å‹™æ±ºç­–ç³»çµ±ï½œæ³•è¦å…§å»ºç‰ˆ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-dark: #2C3E50;    /* å°ˆæ¥­æ·±è— */
            --primary-gold: #C5A065;    /* è³ªæ„Ÿé‡‘ */
            --primary-light: #ECF0F1;   /* æ·ºç°åº• */
            --accent-red: #C0392B;      /* å¼·èª¿ç´… */
            --accent-green: #27AE60;    /* æˆåŠŸç¶  */
            --bg-body: #F4F6F6;
            --bg-card: #FFFFFF;
            --border: #D5D8DC;
        }

        * { box-sizing: border-box; outline: none; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--bg-body); color: #333; margin: 0; padding: 20px; line-height: 1.6; font-size: 15px; }

        /* Badge */
        .internal-badge { background: var(--primary-gold); color: white; padding: 5px 15px; border-radius: 4px; font-size: 0.8rem; position: fixed; top: 20px; right: 20px; z-index: 999; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        /* Header */
        .header { text-align: center; margin-bottom: 30px; }
        .logo-group img { height: 60px; margin: 0 10px; vertical-align: middle; }
        .header h1 { color: var(--primary-dark); font-size: 1.8rem; margin: 15px 0 5px; font-weight: 800; }
        .header .subtitle { color: #7F8C8D; font-size: 1rem; }

        /* Layout */
        .container { display: grid; grid-template-columns: 1fr; gap: 25px; max-width: 1400px; margin: 0 auto; }
        @media(min-width: 1200px) { .container { grid-template-columns: 400px 1fr; } }

        /* Cards */
        .card { background: var(--bg-card); border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); border: 1px solid #FFF; margin-bottom: 20px; transition: 0.3s; }
        .card:hover { box-shadow: 0 8px 25px rgba(0,0,0,0.08); }
        .card-header { font-size: 1.1rem; font-weight: 700; color: var(--primary-dark); border-bottom: 2px solid var(--primary-light); padding-bottom: 10px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }

        /* Inputs */
        .input-group { margin-bottom: 15px; }
        .input-row { display: flex; gap: 10px; margin-bottom: 12px; align-items: flex-end; }
        .input-col { flex: 1; }
        .label { display: block; font-size: 0.9rem; font-weight: 600; color: #555; margin-bottom: 5px; }
        .input { width: 100%; padding: 10px; border: 1px solid #BDC3C7; border-radius: 6px; text-align: right; font-size: 1rem; font-family: 'Consolas', monospace; background: #FAFAFA; }
        .input:focus { border-color: var(--primary-dark); background: #FFF; }
        .input-readonly { background: #EAECEE; color: #7F8C8D; cursor: default; }
        select.input { text-align: left; }

        /* Highlight Section */
        .highlight-box { background: #FFF9C4; border: 1px dashed #F1C40F; padding: 15px; border-radius: 8px; margin-top: 15px; }
        .input-highlight { border: 2px solid #F1C40F; background: #FFF; font-weight: bold; font-size: 1.2rem; color: #D35400; }

        /* Tables */
        .table-container { overflow-x: auto; border: 1px solid var(--border); border-radius: 8px; margin-bottom: 20px; }
        .data-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; min-width: 500px; }
        .data-table th { background: var(--primary-dark); color: white; text-align: left; padding: 10px 15px; font-weight: 500; }
        .data-table td { padding: 10px 15px; border-bottom: 1px solid #EEE; color: #333; }
        .data-table tr:last-child td { border-bottom: none; }
        .data-table .num { text-align: right; font-family: 'Consolas', monospace; font-weight: 600; }
        
        /* Regulation Table Styles */
        .reg-table th { background: #EBF5FB; color: var(--primary-dark); font-weight: 700; border-bottom: 2px solid #AED6F1; }
        .reg-table td { vertical-align: top; line-height: 1.6; }
        .tag { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: bold; margin-right: 5px; }
        .tag-bonus { background: #E8F8F5; color: #27AE60; border: 1px solid #27AE60; }
        .tag-warn { background: #FEF9E7; color: #D35400; border: 1px solid #D35400; }

        /* Buttons */
        .btn-fill { background: transparent; border: 1px solid var(--primary-dark); color: var(--primary-dark); padding: 4px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; }
        .btn-fill:hover { background: var(--primary-dark); color: white; }
        .btn-print { background: var(--primary-dark); color: white; width: 100%; padding: 15px; border: none; border-radius: 8px; font-weight: bold; font-size: 1rem; cursor: pointer; margin-top: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .btn-print:hover { background: #34495E; }

        /* Tabs */
        .tab-group { display: flex; border-bottom: 2px solid var(--border); margin-bottom: 20px; background: #FFF; border-radius: 8px 8px 0 0; }
        .tab { padding: 15px 25px; cursor: pointer; font-size: 1rem; font-weight: 600; color: #95A5A6; border-bottom: 3px solid transparent; transition: 0.3s; }
        .tab:hover { color: var(--primary-dark); }
        .tab.active { color: var(--primary-dark); border-bottom-color: var(--primary-dark); background: #F8F9F9; }
        
        .section-box { display: none; animation: fadeIn 0.4s; }
        .section-box.active { display: block; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Print */
        @media print {
            body { background: white; padding: 0; }
            .btn-print, .btn-fill, .internal-badge { display: none; }
            .card { box-shadow: none; border: 1px solid #000; break-inside: avoid; }
            .container { display: block; }
            .section-box { display: block !important; margin-bottom: 30px; }
            .tab-group { display: none; }
        }
    </style>
</head>
<body>

<div class="internal-badge">V10.0 æ——è‰¦ç‰ˆ</div>

<div class="header">
    <div class="logo-group">
        <img src="å®åœ‹åœ°æ”¿å°é¢.jpg">
        <img src="æ˜“ä¸logo-01.jpg">
    </div>
    <h1>å°å—åœŸåœ°é–‹ç™¼è²¡å‹™æ±ºç­–ç³»çµ±</h1>
    <div class="subtitle">åªæ•¸åˆ¶ï½œæ³•è¦é€ŸæŸ¥åº«ï½œå»ºè”½ç‡æª¢è¨ï½œè²¡å‹™ç²¾ç®—</div>
</div>

<div class="container">
    
    <div class="left-panel">
        
        <div class="card" style="border-top: 4px solid var(--primary-gold);">
            <div class="card-header">
                1. åŸºåœ°æ¢ä»¶ (è¼¸å…¥åªæ•¸)
                <button class="btn-fill" onclick="resetDefault()">é‡ç½®</button>
            </div>
            
            <div class="input-row">
                <div class="input-col">
                    <label class="label">åœŸåœ°é¢ç© (åª)</label>
                    <input type="number" id="inPing" class="input" value="52" oninput="calcArea()">
                </div>
                <div class="input-col">
                    <label class="label">æ›ç®— mÂ²</label>
                    <input type="text" id="outSqm" class="input input-readonly" readonly>
                </div>
            </div>

            <div class="input-group">
                <label class="label">é–‹ç™¼æ¨¡å¼</label>
                <select id="inType" class="input" onchange="toggleMode(); calcArea();">
                    <option value="tou-tian">é€å¤© (ä¾å»ºè”½ç‡èˆ‡æ¨“å±¤)</option>
                    <option value="da-lou">å¤§æ¨“ (ä¾å®¹ç©ç‡)</option>
                </select>
            </div>

            <div class="input-row">
                <div class="input-col">
                    <label class="label">æ³•å®šå»ºè”½ç‡ (%)</label>
                    <input type="number" id="inBCR" class="input" value="60" oninput="calcArea()">
                </div>
                <div class="input-col">
                    <label class="label">æ³•å®šå®¹ç©ç‡ (%)</label>
                    <input type="number" id="inFAR" class="input" value="200" oninput="calcArea()">
                </div>
            </div>

            <div class="highlight-box">
                <div class="input-group">
                    <label class="label" style="color:#D35400;">â˜… å¯¦éš›å¯éŠ·å”®ç¸½å»ºåª</label>
                    <input type="number" id="inRealSaleArea" class="input input-highlight" value="0" oninput="calcFinance()">
                    <div style="text-align:right; font-size:0.8rem; color:#D35400; margin-top:5px;" id="fbEfficiency">åªæ•ˆï¼š0.00 å€</div>
                </div>
                
                <div style="display:flex; justify-content:space-between; align-items:center; margin-top:10px;">
                    <div style="font-size:0.85rem; color:#666;">
                        ç³»çµ±ä¼°ç®—ï¼š<span id="txtEstArea" style="font-weight:bold; color:var(--primary-dark)">0</span> åª
                    </div>
                    <button class="btn-fill" onclick="useEstimate()">å¸¶å…¥ä¼°ç®—</button>
                </div>
                <p style="font-size:0.75rem; color:#7F8C8D; margin-top:8px; line-height:1.4;">
                    *é€å¤©ä¼°ç®—åƒæ•¸å·²ä¿®æ­£ç‚ºæ³•å®¹ä¹‹ <strong>1.35å€</strong> (å«é™½å°/å±‹çª/æ¢¯é–“)ã€‚<br>
                    *è«‹ä¾å»ºç¯‰å¸«å¯¦éš›æ’ç‰ˆæ•¸å­—ç‚ºæº–ã€‚
                </p>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                2. ç‡Ÿæ”¶èˆ‡æˆæœ¬
                <button class="btn-fill" onclick="autoCost()">å¸¶å…¥å…¬å ±</button>
            </div>
            <div class="input-row">
                <div class="input-col">
                    <label class="label">å¹³å‡æˆ¿åƒ¹ (è¬/åª)</label>
                    <input type="number" id="inPrice" class="input" value="32" oninput="calcFinance()">
                </div>
                <div class="input-col">
                    <label class="label">è»Šä½ç¸½éŠ· (è¬)</label>
                    <input type="number" id="inParkingSales" class="input" value="0" oninput="calcFinance()">
                </div>
            </div>
            <div class="input-row">
                <div class="input-col">
                    <label class="label">åœŸåœ°æˆæœ¬ (è¬/åª)</label>
                    <input type="number" id="inLandCost" class="input" value="40" oninput="calcFinance()">
                </div>
                <div class="input-col">
                    <label class="label">ç‡Ÿé€ å–®åƒ¹ (è¬/åª)</label>
                    <input type="number" id="inConstCost" class="input" value="10.5" oninput="calcFinance()">
                </div>
            </div>
            <div class="input-group">
                <label class="label">ç®¡éŠ·è²»ç‡ (%) <span style="font-weight:normal; color:#999; font-size:0.8rem;">(å«è¨­è¨ˆ/éŠ·å”®/ç®¡ç†)</span></label>
                <input type="number" id="inOverhead" class="input" value="14" oninput="calcFinance()">
            </div>
        </div>

        <div class="card" style="border-left: 4px solid #3498DB;">
            <div class="card-header">3. åœŸå»ºèè³‡è¨­å®š</div>
            <div class="input-row">
                <div class="input-col">
                    <label class="label">åœŸè (è¬)</label>
                    <input type="number" id="inLandLoan" class="input" value="1500" oninput="calcFinance()">
                </div>
                <div class="input-col">
                    <label class="label">åˆ©ç‡ (%)</label>
                    <input type="number" id="inLandRate" class="input" value="2.5" step="0.1" oninput="calcFinance()">
                </div>
            </div>
            <div class="input-row">
                <div class="input-col">
                    <label class="label">å»ºè (è¬)</label>
                    <input type="number" id="inConstLoan" class="input" value="800" oninput="calcFinance()">
                </div>
                <div class="input-col">
                    <label class="label">åˆ©ç‡ (%)</label>
                    <input type="number" id="inConstRate" class="input" value="2.8" step="0.1" oninput="calcFinance()">
                </div>
            </div>
            <div class="input-row">
                <div class="input-col">
                    <label class="label">å€Ÿæ¬¾å¹´æœŸ</label>
                    <input type="number" id="inLoanYears" class="input" value="2" step="0.5" oninput="calcFinance()">
                </div>
                <div class="input-col">
                    <label class="label">é‚„æ¬¾æ–¹å¼</label>
                    <select id="inRepayMethod" class="input" onchange="calcFinance()">
                        <option value="interest_only">åƒ…æŒ‰æœˆç¹³æ¯</option>
                        <option value="pmt">æœ¬æ¯æ”¤é‚„</option>
                    </select>
                </div>
            </div>
        </div>

        <button class="btn-print" onclick="window.print()">ğŸ–¨ï¸ åˆ—å°åˆ†æå ±å‘Š</button>
    </div>

    <div class="right-panel">
        
        <div class="tab-group">
            <div class="tab active" onclick="switchTab('tab1')">A. è²¡å‹™æç›Šè¡¨</div>
            <div class="tab" onclick="switchTab('tab2')">B. æ³•è¦é€ŸæŸ¥ (å…è¨ˆ/çå‹µ/å®¹ç§»)</div>
            <div class="tab" onclick="switchTab('tab3')">C. é¢ç©é©—ç®—æ˜ç´°</div>
        </div>

        <div id="tab1" class="section-box active">
            
            <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap:15px; margin-bottom:20px;">
                <div class="card" style="background:#2C3E50; color:white; padding:15px; margin:0; text-align:center;">
                    <div style="font-size:0.8rem; opacity:0.8;">é ä¼°ç¸½éŠ·é‡‘é¡</div>
                    <div style="font-size:1.4rem; font-weight:bold;" id="kpiSales">0</div>
                </div>
                <div class="card" style="background:white; border:1px solid #BDC3C7; padding:15px; margin:0; text-align:center;">
                    <div style="font-size:0.8rem; color:#7F8C8D;">å…¨æ¡ˆç¸½æˆæœ¬</div>
                    <div style="font-size:1.4rem; font-weight:bold; color:#2C3E50;" id="kpiCost">0</div>
                </div>
                <div class="card" style="background:#F1C40F; color:#FFF; padding:15px; margin:0; text-align:center; border:none;">
                    <div style="font-size:0.8rem; color:#7F8C8D; font-weight:bold;">è‡ªæœ‰è³‡é‡‘å›å ±ç‡ (ROE)</div>
                    <div style="font-size:1.4rem; font-weight:bold; color:#FFF;" id="kpiROE">0%</div>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th colspan="2">å°ˆæ¡ˆæç›Šé ä¼°è¡¨ (Pro Forma)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>(+) æˆ¿åœ°ç¸½éŠ·é‡‘é¡ <span style="font-size:0.8rem; color:#999">(å–®åƒ¹Ã—éŠ·åª)</span></td>
                            <td class="num" id="tSales">0</td>
                        </tr>
                        <tr>
                            <td style="padding-left:20px;">- åœŸåœ°æˆæœ¬</td>
                            <td class="num" id="tLandCost">0</td>
                        </tr>
                        <tr>
                            <td style="padding-left:20px;">- ç‡Ÿå»ºæ–½å·¥è²»</td>
                            <td class="num" id="tConstCost">0</td>
                        </tr>
                        <tr>
                            <td style="padding-left:20px;">- ç®¡éŠ·è²»ç”¨</td>
                            <td class="num" id="tOverhead">0</td>
                        </tr>
                        <tr>
                            <td style="padding-left:20px;">- èè³‡åˆ©æ¯ <span style="font-size:0.8rem; color:#C0392B;">(å»ºèå‹•ç”¨60%)</span></td>
                            <td class="num" style="color:#C0392B" id="tInterest">0</td>
                        </tr>
                        <tr style="background:#FCF3CF;">
                            <td style="font-weight:bold; color:#D35400;">(=) ç¨…å‰æ·¨åˆ© (EBIT)</td>
                            <td class="num" style="color:#D35400; font-size:1.1rem;" id="tPreTax">0</td>
                        </tr>
                        <tr>
                            <td>(-) é ä¼°ç¨…è²  (åœŸå¢+æˆ¿åœ°åˆä¸€ 20%)</td>
                            <td class="num" style="color:#C0392B" id="tTax">0</td>
                        </tr>
                        <tr style="background:#E8F8F5;">
                            <td style="font-weight:bold; color:#27AE60;">(=) ç¨…å¾Œæ·¨åˆ© (Net Income)</td>
                            <td class="num" style="color:#27AE60; font-size:1.2rem;" id="tNetProfit">0</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="tab2" class="section-box">
            
            <div class="card">
                <div class="card-header">1. å…è¨ˆå®¹ç©é …ç›® (å»ºç¯‰æŠ€è¡“è¦å‰‡)</div>
                <div class="table-container">
                    <table class="data-table reg-table">
                        <tr>
                            <th width="30%">é …ç›®</th>
                            <th>è¦å®šèˆ‡ä¸Šé™</th>
                        </tr>
                        <tr>
                            <td><span class="tag tag-bonus">é™½å°</span></td>
                            <td>æ¯å±¤ â‰¦ è©²å±¤æ¨“åœ°æ¿é¢ç© <strong>10%</strong>ã€‚</td>
                        </tr>
                        <tr>
                            <td><span class="tag tag-bonus">æ¢¯å»³</span></td>
                            <td>æ¯å±¤ â‰¦ è©²å±¤æ¨“åœ°æ¿é¢ç© <strong>10%</strong> (éœ€æœ‰å…±åŒæ¢¯å»³)ã€‚<br>è¨»ï¼šé™½å°+æ¢¯å»³åˆè¨ˆ â‰¦ 15%ã€‚</td>
                        </tr>
                        <tr>
                            <td><span class="tag tag-bonus">å±‹çª</span></td>
                            <td>å»ºç¯‰é¢ç©çš„ <strong>1/8 (12.5%)</strong> æˆ– 25 mÂ² å–å¤§è€…ã€‚<br>é«˜å±¤å»ºç¯‰å¯é” 15%ã€‚</td>
                        </tr>
                        <tr>
                            <td><span class="tag tag-bonus">æ©Ÿé›»è¨­å‚™</span></td>
                            <td>å«æ©Ÿæˆ¿ã€æ°´ç®±ã€å®‰å…¨æ¢¯é–“ç­‰ï¼Œåˆè¨ˆ â‰¦ ç¸½å®¹ç© <strong>15%</strong>ã€‚</td>
                        </tr>
                        <tr>
                            <td><span class="tag tag-bonus">åœè»Šç©ºé–“</span></td>
                            <td>ä¾æ³•è¨­ç½®ä¹‹åœ°ä¸‹åœè»Šç©ºé–“å…è¨ˆå®¹ç© (é™¤è‡¨12ç±³è·¯é€å¤©ä¸€æ¨“è»Šä½å¤–)ã€‚</td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="card">
                <div class="card-header">2. çå‹µå®¹ç©é …ç›® (éƒ½æ›´/å±è€)</div>
                <div class="table-container">
                    <table class="data-table reg-table">
                        <tr>
                            <th width="30%">é …ç›®</th>
                            <th>çå‹µé¡åº¦ (ä¸Šé™)</th>
                        </tr>
                        <tr>
                            <td><span class="tag tag-bonus">ç¶ å»ºç¯‰</span></td>
                            <td>é‘½çŸ³10%ã€é»ƒé‡‘8%ã€éŠ€6%ã€éŠ…4%ã€åˆæ ¼2%ã€‚</td>
                        </tr>
                        <tr>
                            <td><span class="tag tag-bonus">æ™ºæ…§å»ºç¯‰</span></td>
                            <td>é‘½çŸ³10%ã€é»ƒé‡‘8%ã€éŠ€6%ã€éŠ…4%ã€åˆæ ¼2%ã€‚</td>
                        </tr>
                        <tr>
                            <td><span class="tag tag-bonus">è€éœ‡è¨­è¨ˆ</span></td>
                            <td>è€éœ‡æ¨™ç«  <strong>10%</strong>ã€‚æ€§èƒ½è©•ä¼°ï¼š6% / 4% / 2%ã€‚</td>
                        </tr>
                        <tr>
                            <td><span class="tag tag-bonus">ç„¡éšœç¤™</span></td>
                            <td>æ¨™ç«  <strong>5%</strong>ã€‚æ€§èƒ½è©•ä¼°ï¼š4% / 3%ã€‚</td>
                        </tr>
                        <tr>
                            <td><span class="tag tag-warn">ä¸Šé™è¦å®š</span></td>
                            <td>å±è€ï¼šåŸºæº–å®¹ç© 30% + æ™‚ç¨‹è¦æ¨¡ 10% = <strong>40%</strong><br>éƒ½æ›´ï¼šä¸€èˆ¬ <strong>50%</strong> (1.5å€)</td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="card">
                <div class="card-header">3. å®¹ç©ç§»è½‰ (å¤è¹Ÿ/å…¬ä¿åœ°)</div>
                <div class="table-container">
                    <table class="data-table reg-table">
                        <tr>
                            <th width="30%">é™åˆ¶é …ç›®</th>
                            <th>å…§å®¹èªªæ˜</th>
                        </tr>
                        <tr>
                            <td>ç§»å…¥ä¸Šé™</td>
                            <td>ä¸€èˆ¬åŸºåœ°ç§»å…¥å®¹ç© â‰¦ åŸºæº–å®¹ç© <strong>30%</strong>ã€‚<br>ç‰¹å®šåœ°å€(éƒ½æ›´/æ·é‹)å¯é” 40~50%ã€‚</td>
                        </tr>
                        <tr>
                            <td>æ¥å—åŸºåœ°æ¢ä»¶</td>
                            <td>éœ€è‡¨æ¥ <strong>8ç±³</strong> (æˆ–10ç±³) ä»¥ä¸Šè¨ˆç•«é“è·¯ã€‚<br>éä½æ–¼å±±å¡åœ°ã€ç¦é™å»ºå€ã€‚</td>
                        </tr>
                        <tr>
                            <td>ç§»è½‰å…¬å¼</td>
                            <td>ç§»å…¥å®¹ç© = é€å‡ºåœ°é¢ç© Ã— (é€å‡ºå…¬å‘Šç¾å€¼/æ¥å—å…¬å‘Šç¾å€¼) Ã— æ¥å—åœ°å®¹ç©ç‡ã€‚</td>
                        </tr>
                    </table>
                </div>
            </div>

        </div>

        <div id="tab3" class="section-box">
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th colspan="2">é¢ç©è¨ˆç®—é©—è­‰æ˜ç´° (å–®ä½ï¼šåª)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>åŸºåœ°é¢ç©</td>
                            <td class="num" id="vLandArea">0</td>
                        </tr>
                        <tr>
                            <td>(x) æ³•å®šå®¹ç©ç‡</td>
                            <td class="num" id="vVolRate">0%</td>
                        </tr>
                        <tr style="background:#F2F4F6">
                            <td>(=) æ³•å®šå®¹ç©æ¨“åœ°æ¿é¢ç© (åŸºæº–)</td>
                            <td class="num" id="vLegalArea">0</td>
                        </tr>
                        <tr>
                            <td>(+) å…è¨ˆå®¹ç©ä¼°ç®— <span style="font-size:0.8rem; color:#999">(é€å¤©ç´„1.35å€/å¤§æ¨“1.6å€)</span></td>
                            <td class="num" id="vAddOn">0</td>
                        </tr>
                        <tr style="border-top:2px solid #D35400;">
                            <td style="font-weight:bold;">ç³»çµ±å»ºè­°ä¼°ç®—å€¼</td>
                            <td class="num" style="color:#D35400;" id="vSysEst">0</td>
                        </tr>
                        <tr style="background:#FEF9E7;">
                            <td style="font-weight:bold; color:#2C3E50;">(â˜…) ä½¿ç”¨è€…æ‰‹å‹•è¨­å®šå€¼</td>
                            <td class="num" style="font-size:1.2rem; font-weight:bold;" id="vUserSet">0</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>

<script>
    // --- åƒæ•¸ ---
    const PING_TO_SQM = 3.305785;
    // é€ åƒ¹åƒè€ƒ
    const COST_DB = { 'tou-tian': 10.5, 'da-lou': 14.5 };

    // --- DOM ---
    const ui = {
        ping: document.getElementById('inPing'),
        sqm: document.getElementById('outSqm'),
        type: document.getElementById('inType'),
        bcr: document.getElementById('inBCR'),
        far: document.getElementById('inFAR'),
        
        realSaleArea: document.getElementById('inRealSaleArea'),
        fbEfficiency: document.getElementById('fbEfficiency'),
        txtEstArea: document.getElementById('txtEstArea'),
        
        price: document.getElementById('inPrice'),
        parkingSales: document.getElementById('inParkingSales'),
        landCost: document.getElementById('inLandCost'),
        constCost: document.getElementById('inConstCost'),
        overhead: document.getElementById('inOverhead'),

        landLoan: document.getElementById('inLandLoan'),
        landRate: document.getElementById('inLandRate'),
        constLoan: document.getElementById('inConstLoan'),
        constRate: document.getElementById('inConstRate'),
        loanYears: document.getElementById('inLoanYears'),
        repayMethod: document.getElementById('inRepayMethod'),

        kpiSales: document.getElementById('kpiSales'),
        kpiCost: document.getElementById('kpiCost'),
        kpiROE: document.getElementById('kpiROE'),

        // Tables
        tSales: document.getElementById('tSales'),
        tLandCost: document.getElementById('tLandCost'),
        tConstCost: document.getElementById('tConstCost'),
        tOverhead: document.getElementById('tOverhead'),
        tInterest: document.getElementById('tInterest'),
        tPreTax: document.getElementById('tPreTax'),
        tTax: document.getElementById('tTax'),
        tNetProfit: document.getElementById('tNetProfit'),

        // Verification
        vLandArea: document.getElementById('vLandArea'),
        vVolRate: document.getElementById('vVolRate'),
        vLegalArea: document.getElementById('vLegalArea'),
        vAddOn: document.getElementById('vAddOn'),
        vSysEst: document.getElementById('vSysEst'),
        vUserSet: document.getElementById('vUserSet')
    };

    let sysEstimatedArea = 0;

    function format(num) { return Math.round(num).toLocaleString(); }

    function switchTab(tabId) {
        document.querySelectorAll('.section-box').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    function toggleMode() { calcArea(); }

    function autoCost() {
        if(COST_DB[ui.type.value]) {
            ui.constCost.value = COST_DB[ui.type.value];
            calcFinance();
        }
    }

    function resetDefault() {
        ui.ping.value = 52;
        ui.far.value = 200;
        calcArea();
    }

    function useEstimate() {
        ui.realSaleArea.value = sysEstimatedArea.toFixed(2);
        calcFinance();
    }

    function calculateLoanInterest(principal, annualRate, years, method) {
        if (principal <= 0 || annualRate <= 0 || years <= 0) return 0;
        let rate = annualRate / 100;
        let monthlyRate = rate / 12;
        let months = Math.ceil(years * 12);
        let totalInterest = 0;

        if (method === 'interest_only') {
            totalInterest = principal * rate * years;
        } else {
            // PMT
            let pmt = principal * (monthlyRate * Math.pow(1 + monthlyRate, months)) / (Math.pow(1 + monthlyRate, months) - 1);
            let totalPayment = pmt * months;
            totalInterest = totalPayment - principal;
        }
        return totalInterest;
    }

    // --- Core Logic ---
    function calcArea() {
        // 1. Unit Conversion
        let ping = parseFloat(ui.ping.value) || 0;
        let sqm = ping * PING_TO_SQM;
        ui.sqm.value = sqm.toFixed(2);

        let far = parseFloat(ui.far.value) / 100 || 0;
        let type = ui.type.value;

        // 2. Legal Area (Base)
        let legalArea = ping * far;

        // 3. Estimate Add-on (Factors)
        let factor = 0;
        if (type === 'tou-tian') {
            // é€å¤©ä¿‚æ•¸ä¿®æ­£ï¼šç´„ 1.35 ~ 1.40 (æ³•å®šå®¹ç©åŸºç¤)
            // å¯¦å‹™ä¸Šé€å¤©é™½å°ã€å±‹çªæœ‰é™
            factor = 1.36; 
        } else {
            // å¤§æ¨“ä¿‚æ•¸ï¼šç´„ 1.6 ~ 1.7 (é«˜å…¬è¨­æ¯”ã€è»Šä½)
            factor = 1.65;
        }

        sysEstimatedArea = legalArea * factor; // é€™æ˜¯ã€Œé ä¼°ã€ç¸½éŠ·åª
        let addOn = sysEstimatedArea - legalArea;

        // UI Update
        ui.txtEstArea.innerText = sysEstimatedArea.toFixed(2);
        
        // Verification Tab Update
        ui.vLandArea.innerText = ping.toFixed(2);
        ui.vVolRate.innerText = (far*100) + "%";
        ui.vLegalArea.innerText = legalArea.toFixed(2);
        ui.vAddOn.innerText = addOn.toFixed(2);
        ui.vSysEst.innerText = sysEstimatedArea.toFixed(2);

        // Auto fill if empty (optional, better let user fill)
        if (parseFloat(ui.realSaleArea.value) === 0) {
            ui.realSaleArea.value = sysEstimatedArea.toFixed(2);
        }

        calcFinance();
    }

    function calcFinance() {
        let saleArea = parseFloat(ui.realSaleArea.value) || 0;
        let ping = parseFloat(ui.ping.value) || 0;

        // Efficiency Feedback
        if(ping > 0) {
            let eff = saleArea / ping;
            ui.fbEfficiency.innerText = `åªæ•ˆï¼š${eff.toFixed(2)} å€`;
            ui.vUserSet.innerText = saleArea.toFixed(2);
        }

        // Revenue
        let price = parseFloat(ui.price.value) || 0;
        let parkingSales = parseFloat(ui.parkingSales.value) || 0;
        let totalSales = (saleArea * price) + parkingSales;

        // Direct Costs
        let landUnitPrice = parseFloat(ui.landCost.value) || 0;
        let totalLandCost = ping * landUnitPrice;

        let constUnitPrice = parseFloat(ui.constCost.value) || 0;
        let totalConstCost = saleArea * constUnitPrice; 

        let overheadRate = (parseFloat(ui.overhead.value) || 0) / 100;
        let totalOverhead = totalSales * overheadRate;

        // Financing
        let lAmt = parseFloat(ui.landLoan.value) || 0;
        let lRate = (parseFloat(ui.landRate.value) || 0);
        let cAmt = parseFloat(ui.constLoan.value) || 0;
        let cRate = (parseFloat(ui.constRate.value) || 0);
        let years = parseFloat(ui.loanYears.value) || 0;
        let repayMethod = ui.repayMethod.value;

        let lInt = calculateLoanInterest(lAmt, lRate, years, repayMethod);
        let cInt = calculateLoanInterest(cAmt, cRate, years, repayMethod) * 0.6; // å»ºèå‹•ç”¨ 60%
        let totalInterest = lInt + cInt;

        // Total
        let totalCost = totalLandCost + totalConstCost + totalOverhead + totalInterest;
        let preTax = totalSales - totalCost;

        // Tax (Simplified for Business)
        // ç‡Ÿæ‰€ç¨… 20% on EBIT (Simplified) + Land Tax
        // *å¯¦éš›æˆ¿åœ°åˆä¸€éœ€æ‰£é™¤åœŸåœ°æ¼²åƒ¹ç¸½æ•¸é¡ï¼Œæ­¤è™•åšä¿å®ˆä¼°è¨ˆ
        let tax = preTax * 0.2; 
        let netProfit = preTax - tax;

        // ROI
        let equity = totalCost - (lAmt + cAmt);
        let roe = (equity > 0) ? (netProfit / equity) * 100 : 0;

        // Render Tables
        ui.kpiSales.innerText = format(totalSales);
        ui.kpiCost.innerText = format(totalCost);
        ui.kpiROE.innerText = roe.toFixed(1) + "%";

        ui.tSales.innerText = format(totalSales);
        ui.tLandCost.innerText = format(totalLandCost);
        ui.tConstCost.innerText = format(totalConstCost);
        ui.tOverhead.innerText = format(totalOverhead);
        ui.tInterest.innerText = format(totalInterest);
        ui.tPreTax.innerText = format(preTax);
        ui.tTax.innerText = format(tax);
        ui.tNetProfit.innerText = format(netProfit);
    }

    // Init
    calcArea();
</script>

</body>
</html>